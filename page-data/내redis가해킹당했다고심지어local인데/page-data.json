{"componentChunkName":"component---src-templates-post-tsx","path":"/내redis가해킹당했다고심지어local인데/","result":{"data":{"logo":{"childImageSharp":{"fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABDklEQVQY003QwUoCURiG4WOExAQVuapFkUFg2cbIKDQMLY1iKMukJEvSMLR0FYqg0K42Ea1aSMsuoe6kVXQHYovGWc3pPTATLh6+/3wzwxx+kQqcLiUC9WpyQZ/8eHsXX5/fbinlkGVZgvznnPt6j5rhYtacXpz5ay+56I0M+WJpiqOeYWbIW8xgFn54MY8JLCOMQ/vZFlqYwro43sw8puNl0zMSiVOcG7+9bfIBJ7hHBXdoo4FnbqOySl6Sc3hCCU2hrxZfKxs1uaYFdYqYaZhZcgcHuEaSD9XLZfUTZpW72EceEaQQRVEs+gqh7MpV8yK4N6128NPpjtn7cNu7GoCrb3caRu15mN6ZBzH+B9oQInTA7ID+AAAAAElFTkSuQmCC","width":400,"height":90,"src":"/static/8637e594ca86d58e20988ba8c4cfc1e7/497c6/thxwelchs-logo-v2.png","srcSet":"/static/8637e594ca86d58e20988ba8c4cfc1e7/497c6/thxwelchs-logo-v2.png 1x"}}},"markdownRemark":{"html":"<h1>사건의 발단</h1>\n<p>어느날.. redis와 관련된 기능을 개발해야 할 일이 있어 redis를 local에서 docker 컨테이너로 실행 후 테스트를 해보고 있었습니다.</p>\n<p>기능은 아주 간단해서 어떤 특정한 상황 때 hash 자료구조로 redis에 key value를 넣으면 되는 것이었는데, 특정한 시간이 지나면 자동으로 해당 key들이 지워질 수 있게 key에 TTL을 지정해주기로 했습니다.</p>\n<p>그래서 TTL을 5분정도로 주고 5분이 지나고 제대로 삭제가 되었는지 확인 해보기로 했습니다.</p>\n<br/>\n<br/>\n<h1>redis 설치, 실행</h1>\n<p>먼저 redis를 로컬에 설치하기 위해 직접 redis-server를 설치해서 실행해도 되지만, 저는 환경의 이식성이나 편리함을 위해 docker를 사용하기로 했습니다.</p>\n<p>개발환경에서 컨테이너를 지속적으로 띄웠다 내렸다 할 것이기 때문에 다음과 같이 <code class=\"language-text\">bitnami/redis</code> 이미지를 사용하는 <code class=\"language-text\">docker-compose.yml</code>를 작성했습니다.</p>\n<blockquote>\n<p>여러 redis docker image가 있겠지만 저는 bitnami에서 배포하는 이미지를 선호합니다. bitnami는 최신 버그 수정 및 기능에 대해 빠른 피드백과 반영이 이루어지기 때문에 그렇습니다.</p>\n</blockquote>\n\n        <deckgo-highlight-code language=\"yaml\" >\n          <code slot=\"code\">redis:\n    image: &#39;bitnami/redis:latest&#39;\n    environment:\n      - ALLOW_EMPTY_PASSWORD=yes # 비밀번호를 생략하고 redis에 접근가능하게 하는 옵션\n    ports:\n      - &#39;6379:6379&#39;</code>\n        </deckgo-highlight-code>\n      \n<p>docker-compose 를 실행해주고 redis-cli로 접속해보면?</p>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">docker-compose up -d</code>\n        </deckgo-highlight-code>\n      \n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">redis-cli</code>\n        </deckgo-highlight-code>\n      \n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 432px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bdf92f978d83c3e3d0886e044533423c/7c246/Untitled.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 13.310580204778159%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVQI12WMuW7CUBQF+QuggBAblGCbxQt+scBLghfZkdgLaNMnkdJE4j9QaOj5y+HZlClGc49GurUw32CICPe1IHrfSufYQYqQ2wkyLD9hmiyYpiVLNNvD2/+yOF5JP09k32eyrz+KnwtatKMmipQn4TEKQ3rWCw+6jTJ06RhORVuzKj8OJlVrPY/pmD5dkaFOYhTnDdWZV3dLd+XDeY7px1hBQpivMWcxq8MHdVWn0TX+0ewNaMhWV/rSJdrdcjdlvwFj32N3t7uS1gAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/bdf92f978d83c3e3d0886e044533423c/7c246/Untitled.png\"\n        srcset=\"/static/bdf92f978d83c3e3d0886e044533423c/8890b/Untitled.png 293w,\n/static/bdf92f978d83c3e3d0886e044533423c/7c246/Untitled.png 432w\"\n        sizes=\"(max-width: 432px) 100vw, 432px\"\n      />\n  </a>\n    </span></p>\n<p>짜잔 이렇게 간단하게 로컬환경에 레디스를 설치해보고 접속까지 너무 짧은순간에 완성되었습니다.</p>\n<p><em>(redis에 직접 접근하기 위해서는 redis-cli 혹은 redis client tool 을 사용해야 하는데, 이 부분은 별도의 설치가 필요하니 각자 OS환경에 맞는 설치가 사전에 필요합니다.)</em></p>\n<br/>\n<br/>\n<h1>테스트</h1>\n<h3>hash 키 저장</h3>\n<p>다음과 같이 입력하면 hello라는 key에 있는 world라는 필드에 hellowrold라는 문자열을 value로 가지게하는 해쉬 자료구조를 저장하게됩니다.</p>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">hset hello world helloworld</code>\n        </deckgo-highlight-code>\n      \n<h3>hash 잘 저장되었는지 확인 순서대로</h3>\n<ol>\n<li>hash key 확인</li>\n<li>hash key 어떤 필드들이 있는지 확인</li>\n<li>hash field에 어떤 value가 저장되었는지 확인</li>\n</ol>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">keys *\nhkeys hello\nhget hello world</code>\n        </deckgo-highlight-code>\n      \n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 287px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fa145fc973b3b2b7f5e6c03a379b0039/4af4d/Untitled%201.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 40.41811846689895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVQoz1VRSXLCQAz0HxJCtiogYbcNBoxXDHjDAQwkBw75/0M606rYBQfVSKNRT3dLC7ISq90FEz9R5xnzKMc0SOClR0TFN0xvK/Vy+4XhIkR36uG1P6njpWfe1Zob72XIClPYm0KCOYdHywi9mS/5bJWha3lo6zaeu4ZEBXYLqoX5CYa7ge6s4acl3OQA04+l2TGXeBtM8T606kHmHcNGS19I7xaMueYpgCA7KcmxkrUXJmRIuenpisV6Bzc+oPj5lQ/ZT8orHPWWRMiUwHeAlEJAsnOUBfTxoTXAY3uIp48xGp2R5Bzgybq+Z/6pC7BIDvJSDKePgZJPMEomy1VxUSy28pmXHNFXfpIx34/sSHqV5yRFUFlKmJ/rTTI4xC0TiCCDeSCAHxNH7nRng766o+9WmMny6LcAGv/LqCSTJcENxbippFDaWA0wZzRUzbuqR9nNG8l/kPP9cp52r80AAAAASUVORK5CYII='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/fa145fc973b3b2b7f5e6c03a379b0039/4af4d/Untitled%201.png\"\n        srcset=\"/static/fa145fc973b3b2b7f5e6c03a379b0039/4af4d/Untitled%201.png 287w\"\n        sizes=\"(max-width: 287px) 100vw, 287px\"\n      />\n  </a>\n    </span></p>\n<h3>hash 키에 expire time 지정</h3>\n<p>TTL 동작여부를 테스트 하기 위해 hash key에 expire 명령을 통해 TTL을 지정해줍니다.</p>\n<p>다음과 같이 명령하면 hello라는 키에는 300초의 ttl을 지정해 줄 수 있습니다.</p>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">expire hello 300</code>\n        </deckgo-highlight-code>\n      \n<p>ttl을 지정해주고 다음과 같이 남아있는 ttl이 있다면? ttl을 반환하게 됩니다.</p>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">ttl hello</code>\n        </deckgo-highlight-code>\n      \n<ul>\n<li>ttl이 남아있으면 해당 값을 반환</li>\n<li>expire time이 설정되어있지 않았으면 <code class=\"language-text\">-1</code> 반환</li>\n<li>key가 삭제되었으면 <code class=\"language-text\">-2</code> 반환</li>\n</ul>\n<p>저는 5분(300초) 로 지정했고 4초가 지나서 다음과 같이 반환되었습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 209px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c3a15bb4d0a72a2e02d041d1d7b26a10/fa79b/Untitled%202.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 19.138755980861244%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2ElEQVQY002P1w6CQBBF+Qvbi7EgYkFBECkqXUHAHk2MiYn//wvX3Uk0PpzszmT3zB1BdSOMTA8DYwnVjaEtY3QnJvozBxJDX28I08/Q6CmQ6V2E1thAT7MxtUPIusscazSHMwhedmayFRMlMLwtrDCnWrECukflDfpqg/T0QIcNUuwAbrKHpDkkOT7eNCDIr+yPD2HupZj7KawopyROUtLJE4qqheL2gh0XqHaGRK07IurimOpKe/DrcYTvOotwh+RwR3Z5YsJSSGwdTlhcKSkXfPmX/tecDx+Ng0EMEsuPAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/c3a15bb4d0a72a2e02d041d1d7b26a10/fa79b/Untitled%202.png\"\n        srcset=\"/static/c3a15bb4d0a72a2e02d041d1d7b26a10/fa79b/Untitled%202.png 209w\"\n        sizes=\"(max-width: 209px) 100vw, 209px\"\n      />\n  </a>\n    </span></p>\n<br/>\n<br/>\n<h1>사라져 버린 key</h1>\n<p>그리곤 약 1분정도 지났을까요? expire time이 얼마나 남았나 확인을 해보니..</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 217px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f062830ad7b56920b2bc371dc468e89/d6985/Untitled%203.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 17.050691244239633%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvklEQVQI1y1O2wqCQBTsF3roRiS0ZV7KwrRM3TKVVpTS7gT1EPT/3zDtbj0M5zBnZs7Upn6MZH+DTXegrELIStCswsSL4GwYissLUX5G+XhDmwdSl+yvUG0fwe4AdnzASwqssyO62gw1IRJGIbBWMXSXwlxsONaSc6OMh2/lA2ItQKZLeVPMOXQnxCxI/97tL3DMhaJVerhLnJ4f5LzVMs7RM2xpEA/qyggd1UJ7OEGTmHJvDsZo9A20xCSG5L4gM2KuBVK8qAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/0f062830ad7b56920b2bc371dc468e89/d6985/Untitled%203.png\"\n        srcset=\"/static/0f062830ad7b56920b2bc371dc468e89/d6985/Untitled%203.png 217w\"\n        sizes=\"(max-width: 217px) 100vw, 217px\"\n      />\n  </a>\n    </span></p>\n<br/>\n<p>…? </p>\n<p><code class=\"language-text\">-2</code>가 반환되었습니다..</p>\n<p>위에서 말씀드렸다시피 <code class=\"language-text\">-2</code>는 key가 삭제되었음을 의미하는데요 어찌된 일일까요?</p>\n<br/>\n<br/>\n<h1>알 수 없는 key</h1>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">keys *</code>\n        </deckgo-highlight-code>\n      \n<p>key가 정말 삭제되었는지 의심이 되어 key 전체목록을 봐보기로 했습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 185px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/ad2ea2ac3c9b45089480ae643666992c/b63e1/Untitled%204.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 51.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiklEQVQoz4WS6VLCQBCE8w54a8kN4b4SICEHgQTCfYglluX7P0abHgtKQMsfW7uT7PR+PTOK5ozhzXbQ+yEaVgAzWMAarVDvDWXVzCGC1R796Qtmu0/5lyhrsMdrudv2Jsg1DJTaDjL1LpSqMUAvWMoH3Q3RtAMRr3T7KOoOytFOEWM4R8ebRuelCLqTLfzlG8LtB8odF6pmIV3rQCFFw/Jxn61IEpNJzQQK9yIBOkhWdMTieVwnC7jLlOV8lVAlvkkVcZsuyXeFlvgyg4Jmwwk3IkwrzmSDwfxVqB/zNTzkqhf7+VKYbPhzuWCHa7jTrcSk4k5iiqotSygOiXT02zmy7IvFb0JLqLqDmVCTls1gWZ7U+kniX0uhNXu8EkLWiwLd4Syi2ol1UrOjuaYpj/4rWDMHQsjX2SnSMeYIHZrEppHwZ+KhhufUCmtl+gsJ2NnRei+2R+t3iVk/Ws9Gs3aoIUViifxR7KSGVcOT+WOQqrTFPsvQckZilYScURLFi60jHe88F5oXhF+wCUKPcsAUfwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/ad2ea2ac3c9b45089480ae643666992c/b63e1/Untitled%204.png\"\n        srcset=\"/static/ad2ea2ac3c9b45089480ae643666992c/b63e1/Untitled%204.png 185w\"\n        sizes=\"(max-width: 185px) 100vw, 185px\"\n      />\n  </a>\n    </span></p>\n<p>정작 있어야 할 <code class=\"language-text\">hello</code> key는 없고 아까는 존재하지 않았던 backup1 ~ 4 key가 생겼네요? </p>\n<p>혹시 뭔가.. 잠깐 컨테이너가 내렸다 올라온건가? 내가 받은 <code class=\"language-text\">bitnami/redis</code> 도커이미지가 잘못되었나? 원래 redis에서는 일정 주기마다 백업을 하는 기본전략이 있나? 라는 생각에 redis 공식문서와 bitnami/redis github issues를 뒤져봤지만 해당 내용에 대해서는 찾을 수 없었습니다.</p>\n<p>이후로 반복적으로 더 테스트해보았고 다음과 같은 결과를 도출해냈습니다.</p>\n<ul>\n<li>짧은 시간(1분 이내)이든 긴시간이든 랜덤하게 key가 갑자기 모두 삭제됌 (ttl 적용 여부와 관계없이)</li>\n</ul>\n<br/>\n<br/>\n<h1>redis 모니터링 해보기</h1>\n<p>그래서 key를 입력한 뒤 갑자기 삭제되기까지 대체 무슨 일들이 일어나는지 더 상세하게 살펴보기 위해 redis를 모니터링 해보기로 했습니다.</p>\n<p>모니터링은 다음과 같이 할 수 있습니다. </p>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">redis-cli monitor</code>\n        </deckgo-highlight-code>\n      \n<p>위 명령을 통해 redis에 어떤 명령들이 내려졌는지 로그를 확인 할 수 있습니다.</p>\n<p>약 5~7분 정도의 모니터링을 진행하고 있었을 때 였을까요? 갑자기 이상한.. 로그가 올라왔습니다.</p>\n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1170px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/15372/Untitled%205.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 16.38225255972696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAn0lEQVQI112NWQ6CQBBEuYX6YYwim8yArCM7aEbRRKP3P0zZM0Rj/Ki8Tld1tVHJB0p5R9qNyHoSMR+uWPMMM9PHfMuwsLjmvz7+b85oLk+04wtiuOkicZwYN2fsskbLDAXcpIaft2CiAz/0CIqBMhKMZrVb+QmWXgRDmR4dOUml5aY1rH0BJy6ppIJN3AQ57KjQs/KnR60uVoVhefrm3sbtXyUDwbquAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/463a7/Untitled%205.png\"\n        srcset=\"/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/8890b/Untitled%205.png 293w,\n/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/1f316/Untitled%205.png 585w,\n/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/463a7/Untitled%205.png 1170w,\n/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/15372/Untitled%205.png 1222w\"\n        sizes=\"(max-width: 1170px) 100vw, 1170px\"\n      />\n  </a>\n    </span></p>\n<p>해당 로그를 분석해보자면 <code class=\"language-text\">flushall</code> 명령으로 모든 key를 지워버리고 <code class=\"language-text\">backup1~4</code> key에 알 수 없는 스크립트 실행문을 저장합니다.</p>\n<p>위 명령이 랜덤하게 제 로컬 redis에서 계속해서 실행되고 있어, 제가 저장했던 key가 모두 삭제되고 알 수 없는 <code class=\"language-text\">backup1~4</code> key들만 남아있게 된 것이었습니다. oh my god</p>\n<p>해당 keyword로 구글링 해본 결과 redis 기본포트 <code class=\"language-text\">6379</code> 가 열려있고 인증정보 없이 접근할 수 있는 환경 일 때</p>\n<p>크롤러봇이 해당되는 redis에 접근하여 모든 키를 지우고 스크립트를 심는거였습니다. 심지어 만약 제 redis docker image가 저의 루트 권한을 획득 할 수 있었다면 아마도 제 로컬은 더 심각한 해킹을 당하게 되었을 것입니다.</p>\n<br/>\n<br/>\n<h1>해결 방법</h1>\n<p>위 문제를 어떻게 해결 할 수 있을까요?</p>\n<p>문제가 발생하는 원인을 다시 파악해보자면 </p>\n<ul>\n<li>redis 서버가 기본포트 <code class=\"language-text\">6379</code>로 열려있음</li>\n<li>인증없이 접근이 가능함</li>\n</ul>\n<p>위 두가지를 만족 할 때 이러한 현상이 일어난다고 볼 수 있습니다.</p>\n<p>그렇다면 우리는 다음과같이 위의 두가지 조건을 만족하지 않게하면 될텐데요</p>\n<ol>\n<li>redis 서버가 기본포트 <code class=\"language-text\">6379</code>가 아닌 다른 포트를 사용함</li>\n<li>인증을 필수로 redis 서버에 접근할 수 있게함</li>\n</ol>\n<p>1번째 방법은 실은 그렇게 좋은 방법은 아닌 것 같습니다. 시스템에서 대체적으로 많이 알려져있는 포트는 가급적이면 변경하지 않고 사용하는 것이 좋습니다.</p>\n<p>저는 2번 방법이 조금 더 합리적인 해결방법이라고 생각되어 redis 서버에 접근하려면 필수로 인증을 하게끔 설정했습니다.</p>\n<br/>\n<br/>\n<h1>redis 패스워드 설정</h1>\n<p>redis에는 패스워드를 설정하는 방법이 있습니다.</p>\n<ul>\n<li><code class=\"language-text\">requirepass</code> option을 통한 패스워드 설정</li>\n<li><code class=\"language-text\">Redis ACL system</code>을 이용한 username, password 설정(Redis 6.0 버전 이상을 사용하는 경우에만 해당)</li>\n</ul>\n<p>자세한 사항은 <a href=\"https://redis.io/commands/auth\">공식문서 Auth</a>에서 확인</p>\n<p>저는 <code class=\"language-text\">bitnami/redis:lates</code> 이미지가 6.0 이상을 사용하고 있기에 ACL system을 사용하기로 했습니다.</p>\n<br/>\n<br/>\n<h2>requirepass 설정</h2>\n<p>ACL system을 사용한다고 하더라도 requirepass 옵션을 설정해주어야 레디스의 인증절차가 활성화되는데요,</p>\n<p>일반적으로 docker가 아닌 local에 직접 redis를 설치하셨다면 <code class=\"language-text\">/etc/redis/6379.conf</code> 파일에서 requirepass라고 쓰여져있는 라인을 주석을 풀고 설정하실 패스워드를 입력하시면 됩니다.</p>\n<p>저는 docker image로 실행하고 있기에 간단하게 도커이미지에 환경변수를 넘기는것만으로 requirepass가 설정 할 수 있습니다. (이런것 또한 도커를 사용하는 장점이라고 생각합니다.)</p>\n<p>기존의 <code class=\"language-text\">ALLOW_EMPTY_PASSWORD</code> 옵션을 비활성화 하고, <code class=\"language-text\">REDIS_PASSWORD</code> 값을 입력해줍니다.</p>\n<p>(참고로 REDIS<em>PASSWORD 값이 없고 ALLOW</em>EMPTY_PASSWORD도 없다면 에러가 나면서 redis container는 실행되지 못하게 됩니다.)</p>\n\n        <deckgo-highlight-code language=\"yaml\" >\n          <code slot=\"code\">redis:\n    image: &#39;bitnami/redis:latest&#39;\n    environment:\n      - REDIS_PASSWORD=설정할패스워드\n#      - ALLOW_EMPTY_PASSWORD=yes\n    ports:\n      - &#39;6379:6379&#39;</code>\n        </deckgo-highlight-code>\n      \n<p>기존의 컨테이너를 내렸다가 새로운 옵션으로 다시 실행합니다.</p>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">docker-compose down &amp;&amp; docker-compose up -d</code>\n        </deckgo-highlight-code>\n      \n<p>이제는 redis-cli에 접속해 명령을 내리려고 하면 <code class=\"language-text\">NOAUTH Authentication required</code> 라는 에러메세지와 함께 명령이 수행되지 않는것을 확인 할 수 있습니다.</p>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">redis-cli\nkeys *</code>\n        </deckgo-highlight-code>\n      \n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 411px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/fb79e4ab15033e3ffd4f09d9de077a80/03a18/Untitled%206.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 18.77133105802048%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQY00WQW1LCQBBFswxQg1oFSh4oZBJCEkLME4OK+KPlBsRf/1wElgtwsYeZKcWPW327qrvPnTFE1pC2G6wgJSxXLNonpjctYtEwzVv8bMlkXhPXDyTNmqi6xxIR0esn7ccPxduOYruj3H5Rvn9juGlOcFtiRwlOkjAQM3qWh2lNMIdjji6u6A5GWv/e5XjocWIHmE4gq6+rKXtjVtz9pqgI8xXV+ll7kcrkyw22TH7qCM5HgQYpr3QmpYCdvkO37x5kqGU3zLj0Yv0cddzy59SPLwfQdVzoL1Bz46TU3pNABevIIyr5n/Y+CYPM4/K4gwAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/fb79e4ab15033e3ffd4f09d9de077a80/03a18/Untitled%206.png\"\n        srcset=\"/static/fb79e4ab15033e3ffd4f09d9de077a80/8890b/Untitled%206.png 293w,\n/static/fb79e4ab15033e3ffd4f09d9de077a80/03a18/Untitled%206.png 411w\"\n        sizes=\"(max-width: 411px) 100vw, 411px\"\n      />\n  </a>\n    </span></p>\n<br/>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">auth 설정한패스워드</code>\n        </deckgo-highlight-code>\n      \n<p><span\n      class=\"gatsby-resp-image-wrapper\"\n      style=\"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 249px;\"\n    >\n      <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/70a04fb49f751f05291fe637d17902fb/8b576/Untitled%207.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n    <span\n    class=\"gatsby-resp-image-background-image\"\n    style=\"padding-bottom: 14.056224899598394%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVQI102OWQ6CQBBEOQSKy4fKosCAoMgSQcAJSiIqGjXq/Q9SDhNI/Kik+nX1IiTHGqvkgF15Q+PtKEdIT6DnJ8r7F4f6A2UZYFtckFcPRLSCGxeMvzmLj1eeoZcXxgsHAglSyLYPY5NA92IoToj5esu95kacT4jHDu1BggwqY6af8iesMEMzr7OM4e8wmi/ZQgbFqQ5JIegzSa0635dNDFQLvZnBfdcT2/pfQ83GD1rsXyVjPLgyAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n  ></span>\n  <img\n        class=\"gatsby-resp-image-image\"\n        alt=\"Untitled\"\n        title=\"Untitled\"\n        src=\"/static/70a04fb49f751f05291fe637d17902fb/8b576/Untitled%207.png\"\n        srcset=\"/static/70a04fb49f751f05291fe637d17902fb/8b576/Untitled%207.png 249w\"\n        sizes=\"(max-width: 249px) 100vw, 249px\"\n      />\n  </a>\n    </span></p>\n<p>설정했던 패스워드로 auth 인증을 해주면 이제 더이상 명령을 할 때 에러메세지가 나오지 않고 명령이 정상적으로 수행됩니다.</p>\n<br/>\n<br/>\n<h2>ACL 설정</h2>\n<p>위 requirepass만으로도 실은 필수 인증정보입력이 활성화되었지만 저는 이왕 하는거 acl system까지 사용해보기로 했습니다.</p>\n<p>acl은 특정 키, 특정 커맨드에 대한 권한제어까지 가능하기 때문에 더 디테일한 인증과 인가를 부여 할 수 있습니다.</p>\n<h3>User 만들기</h3>\n<p>다음과 같이 user를 생성하게 되면 </p>\n<p>모든 키, 모든 명령에 대해 권한을 가지고 비밀번호가 pass12345인 user2 username을 가진 user를 생성하게됩니다.</p>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">ACL SETUSER user2 on &gt;pass12345 allkeys allcommands</code>\n        </deckgo-highlight-code>\n      \n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">ACL list</code>\n        </deckgo-highlight-code>\n      \n<h3>생성한 User로 인증하고 명령</h3>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">auth user2 pass12345\nkeys *</code>\n        </deckgo-highlight-code>\n      \n<h3>redis 모니터링</h3>\n\n        <deckgo-highlight-code language=\"bash\" >\n          <code slot=\"code\">redis-cli --user user2 --pass pass12345 monitor</code>\n        </deckgo-highlight-code>\n      \n<br/>\n<br/>\n<h1>결론</h1>\n<p>위 해결방법에 따라 redis에 인증시스템을 활성해주고 나니 더이상 key가 이유없이 삭제되거나 이상한 스크립트가 삽입된 key가 생성되거나 하는 현상은 사라졌습니다.</p>\n<p>실은 상용, 베타, stage 환경의 레디스 서버 인스턴스라면 당연히 기본적으로 인증시스템을 활성화해주어서 이러한 현상은 일어나지 않았겠지만, 일반적으로 로컬에서 실행하는 레디스 서버를 굳이 인증을 신경써야하나? 라는 생각에서 비롯된 상황인 것 같았습니다.</p>\n<p>앞으로는 비록 로컬에서 실행하는 환경일지라도 더욱 보안에 신경써야 할 것 같습니다.</p>\n<h1>참고</h1>\n<blockquote>\n<p><a href=\"https://redis.io/commands/auth\">https://redis.io/commands/auth</a>\n<a href=\"http://redisgate.kr/redis/server/acl.php\">http://redisgate.kr/redis/server/acl.php</a></p>\n</blockquote>","htmlAst":{"type":"root","children":[{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"사건의 발단"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"어느날.. redis와 관련된 기능을 개발해야 할 일이 있어 redis를 local에서 docker 컨테이너로 실행 후 테스트를 해보고 있었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"기능은 아주 간단해서 어떤 특정한 상황 때 hash 자료구조로 redis에 key value를 넣으면 되는 것이었는데, 특정한 시간이 지나면 자동으로 해당 key들이 지워질 수 있게 key에 TTL을 지정해주기로 했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그래서 TTL을 5분정도로 주고 5분이 지나고 제대로 삭제가 되었는지 확인 해보기로 했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"redis 설치, 실행"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"먼저 redis를 로컬에 설치하기 위해 직접 redis-server를 설치해서 실행해도 되지만, 저는 환경의 이식성이나 편리함을 위해 docker를 사용하기로 했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"개발환경에서 컨테이너를 지속적으로 띄웠다 내렸다 할 것이기 때문에 다음과 같이 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"bitnami/redis"}]},{"type":"text","value":" 이미지를 사용하는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"docker-compose.yml"}]},{"type":"text","value":"를 작성했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"여러 redis docker image가 있겠지만 저는 bitnami에서 배포하는 이미지를 선호합니다. bitnami는 최신 버그 수정 및 기능에 대해 빠른 피드백과 반영이 이루어지기 때문에 그렇습니다."}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"yaml"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"redis:\n    image: 'bitnami/redis:latest'\n    environment:\n      - ALLOW_EMPTY_PASSWORD=yes # 비밀번호를 생략하고 redis에 접근가능하게 하는 옵션\n    ports:\n      - '6379:6379'"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"docker-compose 를 실행해주고 redis-cli로 접속해보면?"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"docker-compose up -d"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"redis-cli"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 432px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/bdf92f978d83c3e3d0886e044533423c/7c246/Untitled.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 13.310580204778159%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAxElEQVQI12WMuW7CUBQF+QuggBAblGCbxQt+scBLghfZkdgLaNMnkdJE4j9QaOj5y+HZlClGc49GurUw32CICPe1IHrfSufYQYqQ2wkyLD9hmiyYpiVLNNvD2/+yOF5JP09k32eyrz+KnwtatKMmipQn4TEKQ3rWCw+6jTJ06RhORVuzKj8OJlVrPY/pmD5dkaFOYhTnDdWZV3dLd+XDeY7px1hBQpivMWcxq8MHdVWn0TX+0ewNaMhWV/rSJdrdcjdlvwFj32N3t7uS1gAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Untitled","title":"Untitled","src":"/static/bdf92f978d83c3e3d0886e044533423c/7c246/Untitled.png","srcSet":["/static/bdf92f978d83c3e3d0886e044533423c/8890b/Untitled.png 293w","/static/bdf92f978d83c3e3d0886e044533423c/7c246/Untitled.png 432w"],"sizes":["(max-width:","432px)","100vw,","432px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"짜잔 이렇게 간단하게 로컬환경에 레디스를 설치해보고 접속까지 너무 짧은순간에 완성되었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"(redis에 직접 접근하기 위해서는 redis-cli 혹은 redis client tool 을 사용해야 하는데, 이 부분은 별도의 설치가 필요하니 각자 OS환경에 맞는 설치가 사전에 필요합니다.)"}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"테스트"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"hash 키 저장"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다음과 같이 입력하면 hello라는 key에 있는 world라는 필드에 hellowrold라는 문자열을 value로 가지게하는 해쉬 자료구조를 저장하게됩니다."}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"hset hello world helloworld"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"hash 잘 저장되었는지 확인 순서대로"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"hash key 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"hash key 어떤 필드들이 있는지 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"hash field에 어떤 value가 저장되었는지 확인"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"keys *\nhkeys hello\nhget hello world"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 287px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/fa145fc973b3b2b7f5e6c03a379b0039/4af4d/Untitled%201.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 40.41811846689895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAICAYAAAD5nd/tAAAACXBIWXMAAAsTAAALEwEAmpwYAAABWElEQVQoz1VRSXLCQAz0HxJCtiogYbcNBoxXDHjDAQwkBw75/0M606rYBQfVSKNRT3dLC7ISq90FEz9R5xnzKMc0SOClR0TFN0xvK/Vy+4XhIkR36uG1P6njpWfe1Zob72XIClPYm0KCOYdHywi9mS/5bJWha3lo6zaeu4ZEBXYLqoX5CYa7ge6s4acl3OQA04+l2TGXeBtM8T606kHmHcNGS19I7xaMueYpgCA7KcmxkrUXJmRIuenpisV6Bzc+oPj5lQ/ZT8orHPWWRMiUwHeAlEJAsnOUBfTxoTXAY3uIp48xGp2R5Bzgybq+Z/6pC7BIDvJSDKePgZJPMEomy1VxUSy28pmXHNFXfpIx34/sSHqV5yRFUFlKmJ/rTTI4xC0TiCCDeSCAHxNH7nRng766o+9WmMny6LcAGv/LqCSTJcENxbippFDaWA0wZzRUzbuqR9nNG8l/kPP9cp52r80AAAAASUVORK5CYII='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Untitled","title":"Untitled","src":"/static/fa145fc973b3b2b7f5e6c03a379b0039/4af4d/Untitled%201.png","srcSet":["/static/fa145fc973b3b2b7f5e6c03a379b0039/4af4d/Untitled%201.png 287w"],"sizes":["(max-width:","287px)","100vw,","287px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"hash 키에 expire time 지정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"TTL 동작여부를 테스트 하기 위해 hash key에 expire 명령을 통해 TTL을 지정해줍니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다음과 같이 명령하면 hello라는 키에는 300초의 ttl을 지정해 줄 수 있습니다."}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"expire hello 300"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ttl을 지정해주고 다음과 같이 남아있는 ttl이 있다면? ttl을 반환하게 됩니다."}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"ttl hello"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"ttl이 남아있으면 해당 값을 반환"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"expire time이 설정되어있지 않았으면 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-1"}]},{"type":"text","value":" 반환"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"key가 삭제되었으면 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-2"}]},{"type":"text","value":" 반환"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"저는 5분(300초) 로 지정했고 4초가 지나서 다음과 같이 반환되었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 209px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/c3a15bb4d0a72a2e02d041d1d7b26a10/fa79b/Untitled%202.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 19.138755980861244%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA2ElEQVQY002P1w6CQBBF+Qvbi7EgYkFBECkqXUHAHk2MiYn//wvX3Uk0PpzszmT3zB1BdSOMTA8DYwnVjaEtY3QnJvozBxJDX28I08/Q6CmQ6V2E1thAT7MxtUPIusscazSHMwhedmayFRMlMLwtrDCnWrECukflDfpqg/T0QIcNUuwAbrKHpDkkOT7eNCDIr+yPD2HupZj7KawopyROUtLJE4qqheL2gh0XqHaGRK07IurimOpKe/DrcYTvOotwh+RwR3Z5YsJSSGwdTlhcKSkXfPmX/tecDx+Ng0EMEsuPAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Untitled","title":"Untitled","src":"/static/c3a15bb4d0a72a2e02d041d1d7b26a10/fa79b/Untitled%202.png","srcSet":["/static/c3a15bb4d0a72a2e02d041d1d7b26a10/fa79b/Untitled%202.png 209w"],"sizes":["(max-width:","209px)","100vw,","209px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"사라져 버린 key"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그리곤 약 1분정도 지났을까요? expire time이 얼마나 남았나 확인을 해보니.."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 217px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/0f062830ad7b56920b2bc371dc468e89/d6985/Untitled%203.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 17.050691244239633%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAvklEQVQI1y1O2wqCQBTsF3roRiS0ZV7KwrRM3TKVVpTS7gT1EPT/3zDtbj0M5zBnZs7Upn6MZH+DTXegrELIStCswsSL4GwYissLUX5G+XhDmwdSl+yvUG0fwe4AdnzASwqssyO62gw1IRJGIbBWMXSXwlxsONaSc6OMh2/lA2ItQKZLeVPMOXQnxCxI/97tL3DMhaJVerhLnJ4f5LzVMs7RM2xpEA/qyggd1UJ7OEGTmHJvDsZo9A20xCSG5L4gM2KuBVK8qAAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Untitled","title":"Untitled","src":"/static/0f062830ad7b56920b2bc371dc468e89/d6985/Untitled%203.png","srcSet":["/static/0f062830ad7b56920b2bc371dc468e89/d6985/Untitled%203.png 217w"],"sizes":["(max-width:","217px)","100vw,","217px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"…? "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-2"}]},{"type":"text","value":"가 반환되었습니다.."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위에서 말씀드렸다시피 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"-2"}]},{"type":"text","value":"는 key가 삭제되었음을 의미하는데요 어찌된 일일까요?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"알 수 없는 key"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"keys *"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"key가 정말 삭제되었는지 의심이 되어 key 전체목록을 봐보기로 했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 185px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/ad2ea2ac3c9b45089480ae643666992c/b63e1/Untitled%204.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 51.891891891891895%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAKCAYAAAC0VX7mAAAACXBIWXMAAAsTAAALEwEAmpwYAAABiklEQVQoz4WS6VLCQBCE8w54a8kN4b4SICEHgQTCfYglluX7P0abHgtKQMsfW7uT7PR+PTOK5ozhzXbQ+yEaVgAzWMAarVDvDWXVzCGC1R796Qtmu0/5lyhrsMdrudv2Jsg1DJTaDjL1LpSqMUAvWMoH3Q3RtAMRr3T7KOoOytFOEWM4R8ebRuelCLqTLfzlG8LtB8odF6pmIV3rQCFFw/Jxn61IEpNJzQQK9yIBOkhWdMTieVwnC7jLlOV8lVAlvkkVcZsuyXeFlvgyg4Jmwwk3IkwrzmSDwfxVqB/zNTzkqhf7+VKYbPhzuWCHa7jTrcSk4k5iiqotSygOiXT02zmy7IvFb0JLqLqDmVCTls1gWZ7U+kniX0uhNXu8EkLWiwLd4Syi2ol1UrOjuaYpj/4rWDMHQsjX2SnSMeYIHZrEppHwZ+KhhufUCmtl+gsJ2NnRei+2R+t3iVk/Ws9Gs3aoIUViifxR7KSGVcOT+WOQqrTFPsvQckZilYScURLFi60jHe88F5oXhF+wCUKPcsAUfwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Untitled","title":"Untitled","src":"/static/ad2ea2ac3c9b45089480ae643666992c/b63e1/Untitled%204.png","srcSet":["/static/ad2ea2ac3c9b45089480ae643666992c/b63e1/Untitled%204.png 185w"],"sizes":["(max-width:","185px)","100vw,","185px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"정작 있어야 할 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"hello"}]},{"type":"text","value":" key는 없고 아까는 존재하지 않았던 backup1 ~ 4 key가 생겼네요? "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"혹시 뭔가.. 잠깐 컨테이너가 내렸다 올라온건가? 내가 받은 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"bitnami/redis"}]},{"type":"text","value":" 도커이미지가 잘못되었나? 원래 redis에서는 일정 주기마다 백업을 하는 기본전략이 있나? 라는 생각에 redis 공식문서와 bitnami/redis github issues를 뒤져봤지만 해당 내용에 대해서는 찾을 수 없었습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이후로 반복적으로 더 테스트해보았고 다음과 같은 결과를 도출해냈습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"짧은 시간(1분 이내)이든 긴시간이든 랜덤하게 key가 갑자기 모두 삭제됌 (ttl 적용 여부와 관계없이)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"redis 모니터링 해보기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그래서 key를 입력한 뒤 갑자기 삭제되기까지 대체 무슨 일들이 일어나는지 더 상세하게 살펴보기 위해 redis를 모니터링 해보기로 했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"모니터링은 다음과 같이 할 수 있습니다. "}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"redis-cli monitor"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 명령을 통해 redis에 어떤 명령들이 내려졌는지 로그를 확인 할 수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"약 5~7분 정도의 모니터링을 진행하고 있었을 때 였을까요? 갑자기 이상한.. 로그가 올라왔습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 1170px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/15372/Untitled%205.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 16.38225255972696%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAn0lEQVQI112NWQ6CQBBEuYX6YYwim8yArCM7aEbRRKP3P0zZM0Rj/Ki8Tld1tVHJB0p5R9qNyHoSMR+uWPMMM9PHfMuwsLjmvz7+b85oLk+04wtiuOkicZwYN2fsskbLDAXcpIaft2CiAz/0CIqBMhKMZrVb+QmWXgRDmR4dOUml5aY1rH0BJy6ppIJN3AQ57KjQs/KnR60uVoVhefrm3sbtXyUDwbquAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Untitled","title":"Untitled","src":"/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/463a7/Untitled%205.png","srcSet":["/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/8890b/Untitled%205.png 293w","/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/1f316/Untitled%205.png 585w","/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/463a7/Untitled%205.png 1170w","/static/fc1ee50bdf9d6e4cc17b50e5fd1874c2/15372/Untitled%205.png 1222w"],"sizes":["(max-width:","1170px)","100vw,","1170px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"해당 로그를 분석해보자면 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"flushall"}]},{"type":"text","value":" 명령으로 모든 key를 지워버리고 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"backup1~4"}]},{"type":"text","value":" key에 알 수 없는 스크립트 실행문을 저장합니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 명령이 랜덤하게 제 로컬 redis에서 계속해서 실행되고 있어, 제가 저장했던 key가 모두 삭제되고 알 수 없는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"backup1~4"}]},{"type":"text","value":" key들만 남아있게 된 것이었습니다. oh my god"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"해당 keyword로 구글링 해본 결과 redis 기본포트 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"6379"}]},{"type":"text","value":" 가 열려있고 인증정보 없이 접근할 수 있는 환경 일 때"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"크롤러봇이 해당되는 redis에 접근하여 모든 키를 지우고 스크립트를 심는거였습니다. 심지어 만약 제 redis docker image가 저의 루트 권한을 획득 할 수 있었다면 아마도 제 로컬은 더 심각한 해킹을 당하게 되었을 것입니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"해결 방법"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 문제를 어떻게 해결 할 수 있을까요?"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"문제가 발생하는 원인을 다시 파악해보자면 "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"redis 서버가 기본포트 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"6379"}]},{"type":"text","value":"로 열려있음"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"인증없이 접근이 가능함"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 두가지를 만족 할 때 이러한 현상이 일어난다고 볼 수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"그렇다면 우리는 다음과같이 위의 두가지 조건을 만족하지 않게하면 될텐데요"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ol","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"redis 서버가 기본포트 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"6379"}]},{"type":"text","value":"가 아닌 다른 포트를 사용함"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"text","value":"인증을 필수로 redis 서버에 접근할 수 있게함"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"1번째 방법은 실은 그렇게 좋은 방법은 아닌 것 같습니다. 시스템에서 대체적으로 많이 알려져있는 포트는 가급적이면 변경하지 않고 사용하는 것이 좋습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"저는 2번 방법이 조금 더 합리적인 해결방법이라고 생각되어 redis 서버에 접근하려면 필수로 인증을 하게끔 설정했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"redis 패스워드 설정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"redis에는 패스워드를 설정하는 방법이 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"ul","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"requirepass"}]},{"type":"text","value":" option을 통한 패스워드 설정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"li","properties":{},"children":[{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"Redis ACL system"}]},{"type":"text","value":"을 이용한 username, password 설정(Redis 6.0 버전 이상을 사용하는 경우에만 해당)"}]},{"type":"text","value":"\n"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"자세한 사항은 "},{"type":"element","tagName":"a","properties":{"href":"https://redis.io/commands/auth"},"children":[{"type":"text","value":"공식문서 Auth"}]},{"type":"text","value":"에서 확인"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"저는 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"bitnami/redis:lates"}]},{"type":"text","value":" 이미지가 6.0 이상을 사용하고 있기에 ACL system을 사용하기로 했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"requirepass 설정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"ACL system을 사용한다고 하더라도 requirepass 옵션을 설정해주어야 레디스의 인증절차가 활성화되는데요,"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"일반적으로 docker가 아닌 local에 직접 redis를 설치하셨다면 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"/etc/redis/6379.conf"}]},{"type":"text","value":" 파일에서 requirepass라고 쓰여져있는 라인을 주석을 풀고 설정하실 패스워드를 입력하시면 됩니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"저는 docker image로 실행하고 있기에 간단하게 도커이미지에 환경변수를 넘기는것만으로 requirepass가 설정 할 수 있습니다. (이런것 또한 도커를 사용하는 장점이라고 생각합니다.)"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"기존의 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"ALLOW_EMPTY_PASSWORD"}]},{"type":"text","value":" 옵션을 비활성화 하고, "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"REDIS_PASSWORD"}]},{"type":"text","value":" 값을 입력해줍니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"(참고로 REDIS"},{"type":"element","tagName":"em","properties":{},"children":[{"type":"text","value":"PASSWORD 값이 없고 ALLOW"}]},{"type":"text","value":"EMPTY_PASSWORD도 없다면 에러가 나면서 redis container는 실행되지 못하게 됩니다.)"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"yaml"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"redis:\n    image: 'bitnami/redis:latest'\n    environment:\n      - REDIS_PASSWORD=설정할패스워드\n#      - ALLOW_EMPTY_PASSWORD=yes\n    ports:\n      - '6379:6379'"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"기존의 컨테이너를 내렸다가 새로운 옵션으로 다시 실행합니다."}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"docker-compose down && docker-compose up -d"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"이제는 redis-cli에 접속해 명령을 내리려고 하면 "},{"type":"element","tagName":"code","properties":{"className":["language-text"]},"children":[{"type":"text","value":"NOAUTH Authentication required"}]},{"type":"text","value":" 라는 에러메세지와 함께 명령이 수행되지 않는것을 확인 할 수 있습니다."}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"redis-cli\nkeys *"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 411px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/fb79e4ab15033e3ffd4f09d9de077a80/03a18/Untitled%206.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 18.77133105802048%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAECAYAAACOXx+WAAAACXBIWXMAAAsTAAALEwEAmpwYAAAA60lEQVQY00WQW1LCQBBFswxQg1oFSh4oZBJCEkLME4OK+KPlBsRf/1wElgtwsYeZKcWPW327qrvPnTFE1pC2G6wgJSxXLNonpjctYtEwzVv8bMlkXhPXDyTNmqi6xxIR0esn7ccPxduOYruj3H5Rvn9juGlOcFtiRwlOkjAQM3qWh2lNMIdjji6u6A5GWv/e5XjocWIHmE4gq6+rKXtjVtz9pqgI8xXV+ll7kcrkyw22TH7qCM5HgQYpr3QmpYCdvkO37x5kqGU3zLj0Yv0cddzy59SPLwfQdVzoL1Bz46TU3pNABevIIyr5n/Y+CYPM4/K4gwAAAABJRU5ErkJggg=='); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Untitled","title":"Untitled","src":"/static/fb79e4ab15033e3ffd4f09d9de077a80/03a18/Untitled%206.png","srcSet":["/static/fb79e4ab15033e3ffd4f09d9de077a80/8890b/Untitled%206.png 293w","/static/fb79e4ab15033e3ffd4f09d9de077a80/03a18/Untitled%206.png 411w"],"sizes":["(max-width:","411px)","100vw,","411px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"auth 설정한패스워드"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-wrapper"],"style":"position: relative; display: block; margin-left: auto; margin-right: auto;  max-width: 249px;"},"children":[{"type":"text","value":"\n      "},{"type":"element","tagName":"a","properties":{"className":["gatsby-resp-image-link"],"href":"/static/70a04fb49f751f05291fe637d17902fb/8b576/Untitled%207.png","style":"display: block","target":"_blank","rel":["noopener"]},"children":[{"type":"text","value":"\n    "},{"type":"element","tagName":"span","properties":{"className":["gatsby-resp-image-background-image"],"style":"padding-bottom: 14.056224899598394%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAADCAYAAACTWi8uAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAsUlEQVQI102OWQ6CQBBEOQSKy4fKosCAoMgSQcAJSiIqGjXq/Q9SDhNI/Kik+nX1IiTHGqvkgF15Q+PtKEdIT6DnJ8r7F4f6A2UZYFtckFcPRLSCGxeMvzmLj1eeoZcXxgsHAglSyLYPY5NA92IoToj5esu95kacT4jHDu1BggwqY6af8iesMEMzr7OM4e8wmi/ZQgbFqQ5JIegzSa0635dNDFQLvZnBfdcT2/pfQ83GD1rsXyVjPLgyAAAAAElFTkSuQmCC'); background-size: cover; display: block;"},"children":[]},{"type":"text","value":"\n  "},{"type":"element","tagName":"img","properties":{"className":["gatsby-resp-image-image"],"alt":"Untitled","title":"Untitled","src":"/static/70a04fb49f751f05291fe637d17902fb/8b576/Untitled%207.png","srcSet":["/static/70a04fb49f751f05291fe637d17902fb/8b576/Untitled%207.png 249w"],"sizes":["(max-width:","249px)","100vw,","249px"]},"children":[]},{"type":"text","value":"\n  "}]},{"type":"text","value":"\n    "}]}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"설정했던 패스워드로 auth 인증을 해주면 이제 더이상 명령을 할 때 에러메세지가 나오지 않고 명령이 정상적으로 수행됩니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h2","properties":{},"children":[{"type":"text","value":"ACL 설정"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 requirepass만으로도 실은 필수 인증정보입력이 활성화되었지만 저는 이왕 하는거 acl system까지 사용해보기로 했습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"acl은 특정 키, 특정 커맨드에 대한 권한제어까지 가능하기 때문에 더 디테일한 인증과 인가를 부여 할 수 있습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"User 만들기"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"다음과 같이 user를 생성하게 되면 "}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"모든 키, 모든 명령에 대해 권한을 가지고 비밀번호가 pass12345인 user2 username을 가진 user를 생성하게됩니다."}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"ACL SETUSER user2 on >pass12345 allkeys allcommands"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"ACL list"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"생성한 User로 인증하고 명령"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"auth user2 pass12345\nkeys *"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"h3","properties":{},"children":[{"type":"text","value":"redis 모니터링"}]},{"type":"text","value":"\n\n        "},{"type":"element","tagName":"deckgo-highlight-code","properties":{"language":"bash"},"children":[{"type":"text","value":"\n          "},{"type":"element","tagName":"code","properties":{"slot":"code"},"children":[{"type":"text","value":"redis-cli --user user2 --pass pass12345 monitor"}]},{"type":"text","value":"\n        "}]},{"type":"text","value":"\n      \n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"br","properties":{},"children":[]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"결론"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"위 해결방법에 따라 redis에 인증시스템을 활성해주고 나니 더이상 key가 이유없이 삭제되거나 이상한 스크립트가 삽입된 key가 생성되거나 하는 현상은 사라졌습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"실은 상용, 베타, stage 환경의 레디스 서버 인스턴스라면 당연히 기본적으로 인증시스템을 활성화해주어서 이러한 현상은 일어나지 않았겠지만, 일반적으로 로컬에서 실행하는 레디스 서버를 굳이 인증을 신경써야하나? 라는 생각에서 비롯된 상황인 것 같았습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"text","value":"앞으로는 비록 로컬에서 실행하는 환경일지라도 더욱 보안에 신경써야 할 것 같습니다."}]},{"type":"text","value":"\n"},{"type":"element","tagName":"h1","properties":{},"children":[{"type":"text","value":"참고"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"blockquote","properties":{},"children":[{"type":"text","value":"\n"},{"type":"element","tagName":"p","properties":{},"children":[{"type":"element","tagName":"a","properties":{"href":"https://redis.io/commands/auth"},"children":[{"type":"text","value":"https://redis.io/commands/auth"}]},{"type":"text","value":"\n"},{"type":"element","tagName":"a","properties":{"href":"http://redisgate.kr/redis/server/acl.php"},"children":[{"type":"text","value":"http://redisgate.kr/redis/server/acl.php"}]}]},{"type":"text","value":"\n"}]}],"data":{"quirksMode":false}},"excerpt":"사건의 발단 어느날.. redis와 관련된 기능을 개발해야 할 일이 있어 redis를 local에서 docker 컨테이너로 실행 후 테스트를 해보고 있었습니다. 기능은 아주 간단해서 어떤 특정한 상황 때 hash 자료구조로 redis에 key val…","timeToRead":6,"frontmatter":{"title":"내 redis가 해킹당했다고? 심지어 local인데?","userDate":"29 August 2021","date":"2021-08-29T07:31:54Z","tags":["redis"],"image":{"childImageSharp":{"fluid":{"base64":"data:image/webp;base64,UklGRnoAAABXRUJQVlA4IG4AAACQAwCdASoUAAsAPtFUo0uoJKMhsAgBABoJYwC+SBu0qjemzRWAAP73gmhaXllxWxzoNy7BxWo3JF9iHdaoC9v7w6lxxSmV9oV8Ja/unpFbNwNXRsFIKTCIKtz0++KfMuV/BlytrAYf6Dzw6AAAAA==","aspectRatio":1.7816091954022988,"src":"/static/74cebb81aa653cf91cde1ea672c18160/ed80f/postbg.webp","srcSet":"/static/74cebb81aa653cf91cde1ea672c18160/30305/postbg.webp 930w,\n/static/74cebb81aa653cf91cde1ea672c18160/ed80f/postbg.webp 1424w","sizes":"(max-width: 1424px) 100vw, 1424px"}}},"author":{"id":"thxwelchs","bio":"thxwelchs","avatar":{"children":[{"__typename":"ImageSharp","fixed":{"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAUCAYAAACNiR0NAAAACXBIWXMAAAsTAAALEwEAmpwYAAAFHUlEQVQ4y23UaUzTdxgH8MdjMrwiEVRALqFaoAflamGWckkLhRZpEQql9KQtxR70X44CLVdBEEQJ4BRkImZRMGSyQ5mKx+amMQ6VeMQ5jZkTyMjmwVBB9xs73/z3TZ4X3zefd88X4J+YlRagBRP+rYuytqZaisuMsiRdwoFgAvUTH/+oLzL4XQ69qTqdSU+plIszV2ft4IE4Nx9azHWASxPWBNGhzMWEQBIE0Kik6E1RSJmcORG+o3Bu44YRxFrzEcrzq0dhQbaXRM9wZFMahZhIDoUC5dJ95Y140KIshazg3MU84nZIICUN6pjYNxc/GHmcETj8NGDLmeNWWs/FvsTm0fLEs4MRHtmPdCzFTYTQkoWDdmszHkxhpwH3RD5gqOu9gFX+D0s3G69fSrs5lhFQ+9ZtxdLr/FTO9E69AdVUV51XhSvuJ/luRY5SK9luwKBUUrQYD3KzQTnQCkNXb7/vsc7vdktQI7pEPPy0KcrSH09JfGU0GOf0Ow2oTlo9JnCTvYghxKMuaxOpFauFsnwMD2ZuV0Byux0EH550ZnhRb1Yw+1/WRJ1D5bENAxWV2LTZjCFzgf6ng6y2zxkBCpTG4KOz9cfIw/WHYa+5EQ8KM4rAcrAJeoZvOG1aT7snJg2i7KBxJPSxoSKN8hU9goGqZfqSOt9dj4Iycl7HxDFRY/ZuiiO3Hkx5xXiQl6WEduUgIO1bp9VxxHsmqg1NBo+aNDHqCzqVBrF53ElbtNykjWi+7xVceIdIiURYsYNsMthBJjfgwTg+D9QcLTTH9zj5xPnfpVDLUOFG+6naImxcVahBZZjlRVFk/mVKYO0Ywb/sQUIC9400X02VSeUgypbiQe8UPyA/9gLSDMWJyqWMC1yLkWld8fc1O7Hv+CIhKmDnzrUxbadJLMP+TIG+jc8TTstE0hBplgTyc/4HjOfwIedEG1SiK8t83LY80nmlH6oUY99W2aveiNV5qJFvR2k+fRPksI5zUYycr9j02J+POvoCjtR1LzxF/SIcGEVnQSyPA0K1xNl1+foxlVg7bqmqQnqNCelEincchn3Om9L2lkz87LG3t+FlOjllEv04u3Z2/AH0NO3Hg3QC7e8nBnCOCAwdq7A5kKXEikqM5nc5dMn8BlIyog34PludJphxXyJF1vDCC0fRwIqh+V5oqKnGg2HkrbBomQu4uPmuDCHQRh2F9Vdadu2Z02oKUGmEAZ2LODZrEskmuEbOFNuTP6mgis603x1a1Xr1KJTprXgwmskB88H9cPz0rWXLnV1+iF3LRjWUStTBcfxeRy1HnxIPPD9J7X49Quq9dSRk9xPP9V7PSzQlXhq1DnIzxHiQ6EMBD1c38F7rsTKcyBrhMJRfajfveyL07UBlZDsaiume6me1T3czWu6YvFW/sSO5z9r2dro7mlvAKDfhQSqFBUVyP7CZI518N6Vc8yY0zLKYx+8Uh55EjZL+iVrj7l8qVI1zffz2URvVeDc2JPl5qkzkzsrhAy9FiAe3cdKgpikROg9plru4kqc2utcjr+ChX4sCe6ewmL3IoG2daZB0vjkW/fF8Z2Ad2uK+eU5fW+kpq9CDRCzHg0plPqSlmkAq1cKOzMz6VK7sBS2s4IaIjl1TRenHrOyK671Je27pOKUPFelyJODyOk4tbOHFhStQavB7KJPnQVdnI6D5mb96uVWdLhBuO8KKCztPZ5C+poUGXg6PCTnLSmIMs4XbJK4r1sCf44rZy0GlUP/n/AGzLBP/3rIs3AAAAABJRU5ErkJggg==","width":151,"height":151,"src":"/static/bf7f9f29887116a6d496e42f356b60db/192fd/thxwelchs.png","srcSet":"/static/bf7f9f29887116a6d496e42f356b60db/192fd/thxwelchs.png 1x"}}]}}}},"relatedPosts":{"totalCount":1,"edges":[{"node":{"id":"2f1764c9-ec06-54f7-b2ed-7b9914f9c308","timeToRead":6,"excerpt":"사건의 발단 어느날.. redis와 관련된 기능을 개발해야 할 일이 있어 redis를 local에서 docker 컨테이너로 실행 후 테스트를 해보고 있었습니다. 기능은 아주 간단해서 어떤 특정한 상황 때 hash 자료구조로 redis에 key val…","frontmatter":{"title":"내 redis가 해킹당했다고? 심지어 local인데?"},"fields":{"slug":"/내redis가해킹당했다고심지어local인데/"}}}]}},"pageContext":{"slug":"/내redis가해킹당했다고심지어local인데/","prev":{"excerpt":"이번 포스팅에서는 내장톰캣과 설치형으로 사용하는 외장톰캣이 무엇이 다른지, 그리고 내장톰캣으로는 해결 할 수 없는것이 있는지\n간단하게 알아보았습니다.\n포스팅 내용을 작성하기 전 이 내용을 조사해본 것은 전 직장 동료분과 오랜만에 만나 개발 담소를 나…","timeToRead":5,"frontmatter":{"title":"Embedded Tomcat과 Tomcat의 차이","tags":["springboot","tomcat"],"date":"2021-08-28T08:42:30Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.7816091954022988,"base64":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAALCAIAAADwazoUAAAACXBIWXMAAAsTAAALEwEAmpwYAAABEklEQVQoz6VSTU/DMAzt3+UvIPFTOCFx48SFU6eJAwdaBIjuo6gCtq5paYfYljRJY6fzWsQKGgI0K4mcJz/72YlT72HOnyNts34g241BN6JBbFVVFizBFmskB2tjDCL+XllrXSnzPB9dRudD5o9Sf8CuheRKqg8ypadztXq/vzrlC0Y+JaaCQghdaap5k/SOvSM/7YVvdxl/AQSlOmQAG9z23bPDPH1qdXue57ou5xwBDeqlWsRxkL2ON/GIUsqtbMaS2Swp5svpZCoEJ4RoZVlSEEmga57FFycHcdhvdMEXcmek33sGgKIohoOHKHoMx0Ge54RT3h0Da/v/dIhZNiYltalpt3II/9c773hqZ58ftgYYsn9LI+SvBgAAAABJRU5ErkJggg==","sizes":"(max-width: 1424px) 100vw, 1424px","src":"/static/e32a388ddc20368c5152e91fc90b7748/6af1e/postbg.png","srcSet":"/static/e32a388ddc20368c5152e91fc90b7748/c5c6c/postbg.png 930w,\n/static/e32a388ddc20368c5152e91fc90b7748/6af1e/postbg.png 1424w"}}},"author":{"id":"thxwelchs","bio":"thxwelchs","avatar":{"children":[{"fixed":{"src":"/static/bf7f9f29887116a6d496e42f356b60db/192fd/thxwelchs.png"}}]}}},"fields":{"layout":"post","slug":"/EmbeddedTomcat과Tomcat의차이/"}},"next":{"excerpt":"의존성 의존성이란 무엇일까? 우리는 객체지향 프로그래밍을 하면서 의존성이란 의미를 정말 가슴 깊이 받아들이고 있을까? 적어도 난 그렇지 않았던 것 같다.. 그래서 맨날 보면서도 까먹는 의존관계 UML 화살표 방향과 코드로써 의존관계를 명확하게 표현해…","timeToRead":4,"frontmatter":{"title":"UML과 코드로 이해하는 의존성","tags":["java","object","객체지향","의존성"],"date":"2021-11-20T11:31:54Z","draft":false,"image":{"childImageSharp":{"fluid":{"aspectRatio":1.7816091954022988,"base64":"data:image/webp;base64,UklGRkoAAABXRUJQVlA4ID4AAACQAwCdASoUAAsAPtFUo0uoJKMhsAgBABoJaQAAW+virGAqOewAAP73fQKTnIxm29WJK92cxDc7Aj1VUAAAAA==","sizes":"(max-width: 1424px) 100vw, 1424px","src":"/static/9da7db0923a63c86a5d390492aca3fde/ed80f/postbg.webp","srcSet":"/static/9da7db0923a63c86a5d390492aca3fde/30305/postbg.webp 930w,\n/static/9da7db0923a63c86a5d390492aca3fde/ed80f/postbg.webp 1424w"}}},"author":{"id":"thxwelchs","bio":"thxwelchs","avatar":{"children":[{"fixed":{"src":"/static/bf7f9f29887116a6d496e42f356b60db/192fd/thxwelchs.png"}}]}}},"fields":{"layout":"post","slug":"/UML과코드로이해하는의존성/"}},"primaryTag":"redis"}},"staticQueryHashes":["3212170248","3213104607","3993936949","794779027"]}